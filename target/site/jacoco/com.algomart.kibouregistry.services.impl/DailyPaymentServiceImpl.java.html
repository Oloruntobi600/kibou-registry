<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DailyPaymentServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">kibou-registry</a> &gt; <a href="index.source.html" class="el_package">com.algomart.kibouregistry.services.impl</a> &gt; <span class="el_source">DailyPaymentServiceImpl.java</span></div><h1>DailyPaymentServiceImpl.java</h1><pre class="source lang-java linenums">package com.algomart.kibouregistry.services.impl;

import com.algomart.kibouregistry.enums.SearchOperation;
import com.algomart.kibouregistry.enums.EventType;
import com.algomart.kibouregistry.exceptions.PaymentNotFoundException;
import com.algomart.kibouregistry.models.PaymentRequest;
import com.algomart.kibouregistry.models.PaymentResponse;
import com.algomart.kibouregistry.models.SearchCriteria;
import com.algomart.kibouregistry.repository.DailyPaymentsRepo;
import com.algomart.kibouregistry.entity.DailyPayments;
import com.algomart.kibouregistry.services.DailyPaymentsService;
import com.algomart.kibouregistry.util.GenericSpecification;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Service;

import java.util.Date;

@Service
public class DailyPaymentServiceImpl implements DailyPaymentsService {
    private final DailyPaymentsRepo dailyPaymentsRepo;

    @Autowired
<span class="fc" id="L25">    public DailyPaymentServiceImpl(DailyPaymentsRepo dailyPaymentsRepo) {</span>
<span class="fc" id="L26">        this.dailyPaymentsRepo = dailyPaymentsRepo;</span>
<span class="fc" id="L27">    }</span>

    public Page&lt;PaymentResponse&gt; findAll(Date startDate, Date endDate, EventType eventType, Pageable pageable) {
<span class="fc" id="L30">        GenericSpecification&lt;DailyPayments&gt; spec = new GenericSpecification&lt;&gt;();</span>
<span class="pc bpc" id="L31" title="1 of 2 branches missed.">        if (startDate != null) {</span>
<span class="fc" id="L32">            spec.add(new SearchCriteria(&quot;date&quot;, startDate, SearchOperation.GREATER_THAN));</span>
        }
<span class="pc bpc" id="L34" title="1 of 2 branches missed.">        if (endDate != null) {</span>
<span class="fc" id="L35">            spec.add(new SearchCriteria(&quot;date&quot;, endDate, SearchOperation.LESS_THAN));</span>
        }
<span class="pc bpc" id="L37" title="1 of 2 branches missed.">        if (eventType != null) {</span>
<span class="fc" id="L38">            spec.add(new SearchCriteria(&quot;eventType&quot;, eventType, SearchOperation.EQUAL));</span>
        }
<span class="fc" id="L40">        Page&lt;DailyPayments&gt; page = dailyPaymentsRepo.findAll(spec, pageable);</span>
<span class="fc" id="L41">        return page.map(this::convertToResponse);</span>
    }

    @Override
    public PaymentResponse findById(Long id) {
<span class="fc" id="L46">        DailyPayments dailyPayments = dailyPaymentsRepo.findById(id)</span>
<span class="fc" id="L47">                .orElseThrow(() -&gt; new PaymentNotFoundException(id));</span>

<span class="fc" id="L49">        return convertToResponse(dailyPayments);</span>
    }

    @Override
    public PaymentResponse save(PaymentRequest paymentRequest) {
<span class="fc" id="L54">        DailyPayments dailyPayments = convertToEntity(paymentRequest);</span>
<span class="fc" id="L55">        dailyPayments = dailyPaymentsRepo.save(dailyPayments);</span>
<span class="fc" id="L56">        return convertToResponse(dailyPayments);</span>
    }

    @Override
    public PaymentResponse update(Long id, PaymentRequest paymentRequest) {
<span class="fc" id="L61">        DailyPayments dailyPayments = dailyPaymentsRepo.findById(id)</span>
<span class="fc" id="L62">                .orElseThrow(() -&gt; new PaymentNotFoundException(id));</span>

<span class="fc" id="L64">        dailyPayments.setDate(paymentRequest.getDate());</span>
<span class="fc" id="L65">        dailyPayments.setTotalAmount(paymentRequest.getTotalAmount());</span>
<span class="fc" id="L66">        dailyPayments.setEventType(paymentRequest.getEventType());</span>

<span class="fc" id="L68">        dailyPayments = dailyPaymentsRepo.save(dailyPayments);</span>
<span class="fc" id="L69">        return convertToResponse(dailyPayments);</span>
    }

    private PaymentResponse convertToResponse(DailyPayments dailyPayments) {
<span class="fc" id="L73">        return new PaymentResponse(</span>
<span class="fc" id="L74">                dailyPayments.getId(),</span>
<span class="fc" id="L75">                dailyPayments.getDate(),</span>
<span class="fc" id="L76">                dailyPayments.getTotalAmount(),</span>
<span class="fc" id="L77">                dailyPayments.getEventType()</span>
        );
    }

    private DailyPayments convertToEntity(PaymentRequest paymentRequest) {
<span class="fc" id="L82">        return new DailyPayments(</span>
                null,
<span class="fc" id="L84">                paymentRequest.getDate(),</span>
<span class="fc" id="L85">                paymentRequest.getTotalAmount(),</span>
<span class="fc" id="L86">                paymentRequest.getEventType()</span>
        );
    }

    @Override
    public void deleteById(Long id) {
<span class="nc" id="L92">        dailyPaymentsRepo.deleteById(id);</span>
<span class="nc" id="L93">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>